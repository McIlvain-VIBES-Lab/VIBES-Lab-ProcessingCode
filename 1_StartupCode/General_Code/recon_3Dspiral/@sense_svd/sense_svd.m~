function ob = sense_svd(A,sen,rank_svd)
%function ob = sense_svd(A,sen, rank_svd)
%	Construct MRI object, which can do Ax and A'y operations
%  sen is nptsxncoils
%  rank is the rank of SVD to use for coil combinations

% This is an attempt to make MRI object valid for sensitivity
%   encoded runs also


%	default object
ob.A = 0;	% should these be []'s
ob.sen = 0;
ob.rank_svd = 0;
ob.num_coils = 0;
ob.V = 0;    % This is the transform from original coils to combined
ob.VS = 0;   % This is the combined sensitivity maps
ob.is.empty	= logical(1);
ob.is.transpose = logical(0);
%ob.version = 1.0;

if nargin == 0
	ob = class(ob, 'sense_svd');
	return
end

if isa(A, 'sense_svd')
	ob = A;
	return
end

if nargin ~= 3  %7
	help sense_svd
	error nargin
end

if size(sen,3) ~= 1
   sprintf('Sense maps must be num pts x num coils. ')
end
       

	%	fill object
	ob.A = A;
	ob.sen = sen;
        [npts num_coils] = size(sen);
        ob.num_coils = num_coils;
        ob.rank_svd = rank_svd;

   

        [U,S,V] = svd(sen,0);
        ob.V = V;
        
        VS = zeros(npts,rank_svd);
        for ii = 1:rank_svd
            temp = zeros(npts,1);
            for jj = 1:num_coils
                 temp = temp + V(ii,jj)*sen(:,jj);
            end
            VS(:,ii) = temp;
        end
        ob.VS = VS;

	ob.is.empty	= logical(0);

%	ob.m = size(we);	% image size
%	ob.n = size(we);

	ob = class(ob, 'sense_svd');



